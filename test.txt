 public FisIdpDepartmentDetails GetDepartment(ref FisUserCreationAugmentedResult fisUserCreationAugmentedResult, string firmName)
        {
            _logger.LogInformation($"getting department from external provider");
            FisIdpDepartmentDetails fisIdpDepartmentModel = null;
            if (!string.IsNullOrEmpty(firmName))
            {

                var httpWebRequest = (HttpWebRequest)WebRequest.Create(_userBusinessSettings.FisIdpDepartmentUrl);
                httpWebRequest.ContentType = "application/json";
                httpWebRequest.Method = "Get";
                httpWebRequest.Headers.Add("X-SunGard-IdP-API-Key", _userBusinessSettings.PanoramaRewriteApiKey);
                httpWebRequest.Headers.Add("Authorization", "Bearer " + _userBusinessSettings.AccessToken);
                httpWebRequest.Headers.Add("Accept", "application/json");
                httpWebRequest.Headers.Add("selected-firm-name", firmName);
                try
                {
                    var httpResponse = (HttpWebResponse)httpWebRequest.GetResponse();
                    using (var streamReader = new StreamReader(httpResponse.GetResponseStream()))
                    {
                        var result = streamReader.ReadToEnd();
                        var arrayList = JObject.Parse(result).ToObject<FisIdpDepartmentDetails>();
                        if (arrayList.data == null)
                        {
                            fisUserCreationAugmentedResult.ErrorMessage = "Department not found in external authentication system";
                            fisUserCreationAugmentedResult.ResponseType = ResponseType.NotFound;
                        }

                        fisIdpDepartmentModel = arrayList;
                    }
                    return fisIdpDepartmentModel;
                }
                catch (WebException ex)
                {
                    var response = (HttpWebResponse)ex.Response;

                    _logger.LogError("Error occurred while finding a department in external provider." + ex.Message);

                    try
                    {
                        var webResponse = (HttpWebResponse)ex.Response;
                        var content = webResponse.GetResponseStream();
                        var encode = System.Text.Encoding.GetEncoding("utf-8");
                        StreamReader readStream = new StreamReader(content, encode);
                        String str = readStream.ReadToEnd();
                        var errLogs = JsonConvert.DeserializeObject<FisIdpValidationModel>(str);

                        _logger.LogError("Logging error string received external provider" + str);

                        if (str.Contains("record not found"))
                        {
                            fisUserCreationAugmentedResult.ResponseType = ResponseType.NotFound;
                            fisUserCreationAugmentedResult.ErrorMessage = "No Department found in external authentication system";
                        }
                    }
                    catch (Exception exception)
                    {
                        fisUserCreationAugmentedResult.ResponseType = ResponseType.ExceptionError;
                        fisUserCreationAugmentedResult.ErrorMessage = "Error occurred while fetching department from external provider.";
                        _logger.LogError("Error occurred while fetching department from external provider." + exception.Message);
                    }
                }
                catch (Exception ex)
                {
                    _logger.LogError("Error occurred while fetching department from external provider " + ex.Message);
                    fisUserCreationAugmentedResult.ResponseType = ResponseType.ExceptionError;
                    fisUserCreationAugmentedResult.ErrorMessage = "Error occurred while fetching department from external provider.";
                }
            }
            return fisIdpDepartmentModel;
        }
